<!doctype html>

<body>
    <canvas id="gameCanvas" width="400" height="600"></canvas>
        <script>
        var username = ''; // Creates an empty variable for the username to be stored in
        while(username == '') { // This loop prevents the user from hitting cancel or entering a blank answer
            username = prompt('What is your name?') || ''; // Prompts the user to enter their name
        }
        
        var difficulty = '';
        while(difficulty == '' & difficulty != 'easy' & difficulty != 'medium' & difficulty != 'hard') {
            difficulty = prompt('What difficulty do you want to play? Easy, Medium or Hard?') || '';
        }
        var canvas, canvasContext, imageAssets; // Defines the major variables in order for canvas to work properly
                
        window.onload = function() { 
            canvas = document.getElementById('gameCanvas');
            canvasContext = canvas.getContext('2d');
            imageAssets = loadImgAssets();
            document.addEventListener('keydown', keyPressed); 
            document.addEventListener('keyup', keyReleased)
            
            setInterval(mainLoop, 1000 / 50); // This sets how fast the mainLoop is updated every second, currently it is 50 frames/second
        }
        
        // Ship info, delcares the variables for the ship
        var shipXpos = 200;
        var shipYpos = 530;
        const SHIP_SIZE = 60;
        
        
        // Ship movement, declares the variables in order for the ship to move
        const LEFT_ARROW_KEY = 37;
        const RIGHT_ARROW_KEY = 39;
        var leftArrowKeyPressed = false;
        var rightArrowKeyPressed = false;
        var shipXspeed = 4;
        
        // Bullet info, declares the variables for the bullet        
        var bulletVisible = false;
        var bulletYpos = -50;
        var bulletXpos = 50;
        const BULLET_WIDTH = 25;
        const BULLET_HEIGHT = 50;
        var bulletSpeed = 5;
        const SPACE_BAR = 32;
        var spaceBarPressed = false;
        
        // General variables
        var startingPos = true;
        var GameRun = true;
        var score = 0;
        var hit;
        
        function mainLoop() { // The main loop function, this is updated 50 times a second
            if(GameRun){ // Only runs these if GameRun is set to true, when they die it is set to false which stops the game
                if (startingPos) {
                    startPos();
                    startingPos = false; // Sets to true at the start, when it does it places the ship in the center of screen, then sets startingPos to false
                }
                colorRect(0, 0, canvas.width, canvas.height, 'black') //bg
                //colorRect(shipXpos ,shipYpos, SHIP_SIZE, SHIP_SIZE, 'white')
                drawText(20,20,'White','Score: ' + score, '20px Arial');
                drawShip(imageAssets.ship, shipXpos, shipYpos, SHIP_SIZE, SHIP_SIZE);
                shipMove(); // Draws the ship
                drawBullet(imageAssets.bullet, bulletXpos, bulletYpos, BULLET_WIDTH, BULLET_HEIGHT);
                bulletMove(); // Draws the bullet
                
            }
        }
        
        function loadImgAssets(){ // This function loads all the images for the game
            imgs = {};
            
            imgs.ship = new Image(); // Defines a new image
            imgs.ship.src = 'images/ship.png'; // Where the image is located
            imgs.bullet = new Image();
            imgs.bullet.src = 'images/bullet.png';
            
            
            return imgs; // Returns all the images to the array
        }
        
        function drawShip(img, dX, dY, dW, dH){ // This function draws the ship onto the canvas
            canvasContext.drawImage(img, dX, dY, dW, dH);
        }
        
        function drawBullet(img, dX, dY, dW, dH){ // This function draws the bullet onto the canvas
            canvasContext.drawImage(img, dX, dY, dW, dH);
        }
        
        function colorRect(x, y, w, h, color) { // This function gives the colorRect to be called with the specific position, size and color for the colorRect
            canvasContext.fillStyle = color;
            canvasContext.fillRect(x, y, w, h);
        }
        
        function keyPressed(evt) { // This function changes *keyPressed to true when the corresponding key is pressed
            if (evt.keyCode == LEFT_ARROW_KEY) {
                leftArrowKeyPressed = true;
            }
            if (evt.keyCode == RIGHT_ARROW_KEY) {
                rightArrowKeyPressed = true;
            }
            if (evt.keyCode == SPACE_BAR) {
                spaceBarPressed = true;
            }
        }
        function keyReleased(evt) { // This function changes *keyPressed to false when the corresponding key is released
            if (evt.keyCode == LEFT_ARROW_KEY) {
                leftArrowKeyPressed = false;
            }
            if (evt.keyCode == RIGHT_ARROW_KEY) {
                rightArrowKeyPressed = false;
            }
            if (evt.keyCode == SPACE_BAR) {
                spaceBarPressed = false;
            }
        }
        
        function shipMove() { // This function updates the ship's X position with the X speed when ArrowKeyPressed is true
            if (leftArrowKeyPressed) {
                shipXpos -= shipXspeed;
            }
            if (rightArrowKeyPressed) {
                shipXpos += shipXspeed;
            }
        }
        
        function bulletMove() { // This function updates bullets's X position with the X speed when spaceBarPressed is true
            if (spaceBarPressed & bulletYpos < 0) {
                bulletXpos = shipXpos + 18; // Testing at the moment
                bulletYpos = shipYpos - 40;
            }
        }
        
        function drawText(x,y,color,msg, sizeStyle){ // This function draws text onto the canvas
            canvasContext.fillStyle = color;
            canvasContext.fillText(msg,x,y);
            canvasContext.font = sizeStyle;
        }
        
        function startPos() { // This function sets the X position of the ship to the middle when the game is started
            shipXpos = canvas.width / 2 - SHIP_SIZE / 2;
        }
    </script>
</body>